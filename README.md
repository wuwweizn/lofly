# LOF基金套利工具

一个用于监控和计算LOF（上市型开放式基金）套利机会的Python工具。

## 功能特点

- 📊 **实时数据获取**：自动获取LOF基金的场内价格和场外净值
- 💰 **套利计算**：自动计算溢价/折价套利机会和预期收益
- 🔍 **多基金监控**：支持同时监控多只LOF基金
- ⏰ **持续监控**：支持持续监控模式，实时发现套利机会
- 📈 **收益分析**：详细计算套利成本和收益
- 🖥️ **Web界面**：提供美观的Web界面，方便操作和查看

## 套利原理

### 溢价套利（场内价格 > 净值）
- **操作**：场内卖出 → 场外申购
- **原理**：当场内交易价格高于净值时，卖出场内份额，用所得资金申购场外份额

### 折价套利（场内价格 < 净值）
- **操作**：场外赎回 → 场内买入
- **原理**：当场内交易价格低于净值时，赎回场外份额，用所得资金买入场内份额

## 安装

### 🐧 Linux一键部署（推荐）

1. **下载项目**：克隆或下载项目到服务器
   ```bash
   git clone <repository-url>
   cd lof1
   ```

2. **运行部署脚本**：
   ```bash
   chmod +x deploy.sh
   ./deploy.sh
   ```
   - 脚本会自动检查Python 3.11环境
   - 自动安装所有依赖
   - 创建启动脚本和必要目录

3. **启动服务**（三种方式）：
   - **前台运行**：`./start_service.sh`（按Ctrl+C停止）
   - **后台运行**：`./start_service_background.sh`（使用nohup）
   - **systemd服务**（推荐，开机自启）：
     ```bash
     sudo ./install_service.sh
     sudo systemctl start lof-arbitrage
     ```

4. **访问应用**：浏览器打开 `http://服务器IP:8505`

**Linux服务管理**：
- 启动服务：`sudo systemctl start lof-arbitrage`
- 停止服务：`sudo systemctl stop lof-arbitrage`
- 查看状态：`sudo systemctl status lof-arbitrage`
- 查看日志：`sudo journalctl -u lof-arbitrage -f`
- 重启服务：`sudo systemctl restart lof-arbitrage`
- 卸载服务：`sudo ./uninstall_service.sh`

**卸载**：
- 运行 `./uninstall.sh` 删除数据文件和启动脚本

### 🪟 Windows一键部署

1. **下载项目**：克隆或下载项目到本地
2. **运行部署脚本**：双击运行 `deploy.bat`
   - 脚本会自动检查Python环境
   - 自动安装所有依赖
   - 创建启动脚本和必要目录
3. **启动服务**：
   - 双击 `start_service.bat` 启动服务（前台运行）
   - 或双击 `start_service_background.bat` 后台运行
4. **访问应用**：浏览器打开 `http://localhost:8505`

**Windows服务安装（可选）**：
- 以管理员身份运行 `install_windows_service.bat` 安装为Windows服务
- 服务将随系统自动启动
- 卸载服务：以管理员身份运行 `uninstall_windows_service.bat`

**卸载**：
- 运行 `uninstall.bat` 删除数据文件和启动脚本

### 📦 手动安装

1. 克隆或下载项目
2. 安装依赖：

```bash
pip install -r requirements.txt
```

## 使用方法

### 🖥️ Web界面（推荐）

启动Web服务器：

```bash
python app.py
```

使用模拟数据测试：

```bash
python app.py --mock
```

然后在浏览器中访问：`http://localhost:8505`

**Web界面功能：**
- 📋 **基金列表**：实时显示所有监控基金的价格、净值、价差和套利状态
- 📊 **详细信息**：点击基金查看详细的套利分析
- 🔄 **自动刷新**：支持自动刷新和手动刷新
- ⚙️ **设置**：可在界面内调整交易费用、套利阈值和监控间隔
- 📝 **操作日志**：记录所有操作和更新信息
- 🎨 **美观界面**：现代化的UI设计，响应式布局

### 💻 命令行界面

#### 1. 监控单个基金

```bash
python main.py -c 161725
```

### 2. 监控多个指定基金

```bash
python main.py -f 161725 161028 160632
```

### 3. 监控所有配置的基金（默认）

```bash
python main.py
```

### 4. 持续监控模式

```bash
python main.py -m
```

持续监控指定基金：

```bash
python main.py -f 161725 161028 -m
```

### 5. 测试模式（使用模拟数据）

```bash
python main.py --mock
```

## 配置说明

编辑 `config.py` 文件可以修改：

- **交易费用**：买入佣金、卖出佣金、申购费率、赎回费率等
- **套利阈值**：最小套利收益率、最小价差等
- **基金列表**：添加要监控的LOF基金代码和名称
- **数据更新间隔**：持续监控时的更新频率

## 输出说明

工具会显示以下信息：

- **实时数据**：场内价格、场外净值、净值日期
- **价差分析**：价格与净值的差值及百分比
- **套利类型**：溢价套利或折价套利
- **操作方式**：具体的套利操作步骤
- **成本分析**：总成本率
- **收益预测**：预期收益率和投入1万元的净收益

## 注意事项

⚠️ **风险提示**：

1. 本工具仅供参考，不构成投资建议
2. 实际套利需要考虑：
   - T+1或T+2的资金到账时间
   - 净值延迟（通常为T-1日净值）
   - 市场波动风险
   - 流动性风险
   - 实际交易费用可能与配置不同
3. 套利存在风险，请谨慎操作
4. 建议在充分了解LOF基金套利机制后再使用

## 数据源

- 价格数据：东方财富API
- 净值数据：东方财富基金数据

## 许可证

MIT License

## 部署脚本说明

### deploy.bat - 一键部署脚本
- 自动检查Python环境
- 自动安装依赖包
- 创建启动脚本和必要目录
- 显示部署信息和访问地址

### start_service.bat - 启动服务（前台）
- 在前台窗口运行服务
- 可以看到实时日志输出
- 按 Ctrl+C 停止服务

### start_service_background.bat - 启动服务（后台）
- 在后台运行服务
- 最小化窗口运行

### stop_service.bat - 停止服务
- 停止所有运行中的服务实例

### install_windows_service.bat - 安装Windows服务
- 需要管理员权限
- 将应用安装为Windows系统服务
- 服务随系统自动启动

### uninstall_windows_service.bat - 卸载Windows服务
- 需要管理员权限
- 停止并删除Windows服务

### uninstall.bat - 卸载脚本
- 删除所有数据文件（用户数据、套利记录、通知等）
- 删除启动脚本
- 保留源代码和依赖包

## 更新日志

### v1.2.0
- ✨ 新增Windows一键部署功能
- ✨ 支持安装为Windows服务
- ✨ 新增用户认证系统（注册/登录）
- ✨ 新增套利记录管理功能
- ✨ 新增站内通知系统
- ✨ 新增用户管理功能（管理员）
- ✨ 新增数据源配置功能（管理员）
- 🔒 用户数据隔离（每个用户独立的自选、记录、设置）
- 🎯 套利机会通知（仅通知收益率>5%的机会）

### v1.1.0
- ✨ 新增Web界面（Flask）
- ✨ 支持可视化基金列表和详细信息
- ✨ 支持界面内设置交易费用和阈值
- ✨ 添加操作日志功能
- ✨ 支持自动刷新功能
- 🎨 现代化的UI设计

### v1.0.0
- 初始版本
- 支持实时数据获取
- 支持套利计算和监控
- 支持单基金和多基金监控
- 支持持续监控模式
